<header class="py-3">
    <nav class="">
        <div class="container-xxl d-flex flex-wrap">
            <a id="header-title" href="{{ '/' | relative_url }}" class="d-flex align-items-center mb-3 mb-lg-0 me-lg-auto h4">
                {%- comment -%} Render title icon; if raster image, pass a small class so the <img> stays small {%- endcomment -%}
                {%- if site.title-icon -%}
                  {%- assign _ti = site.title-icon -%}
                  {%- if _ti contains '.png' or _ti contains '.jpg' or _ti contains '.jpeg' or _ti contains '.gif' -%}
                    <span class="me-2">{% include icon.html icon=site.title-icon class="title-icon-img" %}</span>
                  {%- else -%}
                    <span class="me-2">{% include icon.html icon=site.title-icon %}</span>
                  {%- endif -%}
                {%- endif -%}
                {{ site.title }}
            </a>
            <form class="ms-auto mb-3 mb-lg-0" role="search" id="search" onsubmit="site_search(); return false;">
                <div class="d-flex align-items-center">
                  <input id="site-search" class="form-control" type="search" placeholder="Search" aria-label="Search box">
                  <!-- bell button placed inline next to search (minimal markup, uses existing IDs for JS) -->
                  <a id="notif-btn" class="btn btn-link position-relative ms-2 p-2" href="#" role="button" aria-label="Notifications" title="Notifications" onclick="event.preventDefault();" style="color:inherit;">
                    <img id="notif-bell-img" src="{{ '/assets/bootstrap-icons/bell.svg' | relative_url }}" width="20" height="20" alt="Notifications" style="vertical-align:middle;" />
                    <!-- inline SVG fallback (hidden by default) -->
                    <svg id="notif-svg-fallback" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="20" height="20" fill="currentColor" aria-hidden="true" style="display:none;vertical-align:middle;">
                      <path d="M8 16a2 2 0 0 0 1.985-1.75H6.015A2 2 0 0 0 8 16zm.104-14a1 1 0 0 0-.208 0L7.5 2H8l-.396-.000z"/>
                      <path d="M8 1a3 3 0 0 1 3 3v2.086l.707.707A1 1 0 0 1 12 8v1l.854 1.707A1 1 0 0 1 12 12H4a1 1 0 0 1-.854-1.293L4 10V9a1 1 0 0 1-.207-.207L3.5 8.786V6a3 3 0 0 1 3-3z"/>
                    </svg>
                    <span id="notif-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size:0.65rem;display:none;min-width:18px;height:18px;line-height:16px;padding:0 4px;">0</span>
                  </a>
                </div>
            </form>
        </div>
    </nav>
</header>
<style>
/* small sizing for raster title icons */
.title-icon-img {
  height: 1em;
  width: auto;
  vertical-align: middle;
  display: inline-block;
}
</style>
<script>
    function site_search() {
    var query = document.getElementById("site-search").value;
    window.open("{{ '/search/index.html' | relative_url }}?q=" + encodeURIComponent(query), "_self" );
    }
</script>

<!-- toast-like popup (hidden by default) used by pusher-configure.js -->
<div id="notif-popup" class="card shadow-sm" role="status" aria-live="polite" style="position:fixed;right:1rem;top:4.5rem;z-index:1080;display:none;min-width:260px;max-width:360px;">
  <div class="card-body p-2 d-flex flex-column">
    <!-- container where JS injects transient notification or history list -->
    <div id="notif-body" style="flex:1;"></div>
    <div class="d-flex justify-content-end mt-2">
      <button type="button" class="btn btn-sm btn-outline-secondary me-2" id="notif-clear-history" title="Clear history">Clear</button>
      <button type="button" class="btn-close" aria-label="Close" id="notif-close"></button>
    </div>
  </div>
</div>

<script>
  // keep existing config injection here
  window.PUSHER_CONFIG = {
    key: "{{ site.pusher.key | default: '' }}",
    cluster: "{{ site.pusher.cluster | default: 'mt1' }}",
    channel: "{{ site.pusher.channel | default: '' }}",
    event: "{{ site.pusher.event | default: '' }}",
    popupTimeout: 5000,
    debug: false
  };
</script>
<script src="{{ '/assets/js/pusher-configure.js' | relative_url }}"></script>

<script>
  // small handler for clear history button (delegated so it doesn't need to be in the JS file)
  document.addEventListener('DOMContentLoaded', function () {
    var clearBtn = document.getElementById('notif-clear-history');
    if (!clearBtn) return;
    clearBtn.addEventListener('click', function (e) {
      try { localStorage.removeItem('padal_notifications_v1'); } catch (err) {}
      var body = document.getElementById('notif-body');
      if (body) body.innerHTML = '<div class="small text-muted">No notifications</div>';
    });
  });
</script>
