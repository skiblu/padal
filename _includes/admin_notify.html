{%- comment -%}
Admin: embed Pusher dashboard console instead of direct-send UI.
Usage: {% include admin-notify.html %}
Note: Many sites (including Pusher) send headers that prevent embedding with iframes.
If embedding is blocked by the browser (X-Frame-Options / CSP), use the "Open Console" button.
{%- endcomment -%}

<div class="admin-notify-wrapper">
  <h3>Pusher Console</h3>

  <div style="margin-bottom:8px;color:#444;font-size:0.95rem;">
    The Pusher dashboard console is embedded below. If the dashboard refuses to load inside this iframe,
    click "Open Console" to open it in a new tab.
  </div>

  <div style="border-radius:8px;overflow:hidden;border:1px solid rgba(0,0,0,0.08);background:#fff;">
    <iframe id="pusher-console-iframe"
            src="https://dashboard.pusher.com/apps/2081560/console"
            title="Pusher Console"
            style="width:100%;height:520px;border:0;display:block;"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups">
    </iframe>
  </div>

  <div style="display:flex;gap:.5rem;align-items:center;margin-top:10px;">
    <a id="open-pusher-console" class="btn-open" href="https://dashboard.pusher.com/apps/2081560/console" target="_blank" rel="noopener noreferrer">Open Console</a>
    <button id="check-iframe" class="btn-check" type="button">Check Embed</button>
    <div id="embed-note" style="color:#666;font-size:0.9rem;margin-left:8px;"></div>
  </div>

  <div style="margin-top:12px;font-size:13px;color:#555;">
      Recommended: For production send functionality implement a server-side relay endpoint that calls Pusher REST API using your app secret.
  </div>
</div>

<style>
  .admin-notify-wrapper {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.07);
      max-width: 820px;
      margin: 20px auto;
      font-family: Arial, sans-serif;
  }
  .admin-notify-wrapper h3 { margin-bottom: 8px; color:#222; }
  .btn-open, .btn-check {
      background: #2575fc;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
  }
  .btn-check { background:#6c757d; }
  .btn-open:hover, .btn-check:hover { opacity:0.95; }
</style>

<script>
  // Lightweight check: if iframe is blocked, browsers may still fire 'load' but contentWindow may be inaccessible.
  (function(){
    var iframe = document.getElementById('pusher-console-iframe');
    var note = document.getElementById('embed-note');
    var checkBtn = document.getElementById('check-iframe');

    function setNote(msg, isError) {
      note.textContent = msg;
      note.style.color = isError ? '#b02a37' : '#2f6f2f';
    }

    // on click, attempt a quick probe
    checkBtn.addEventListener('click', function(){
      setNote('Checking embed…');
      // short timeout to allow load if in progress
      setTimeout(function(){
        try {
          // Accessing contentDocument on cross-origin iframe will throw. Use that to detect blocking.
          var doc = iframe.contentDocument || iframe.contentWindow.document;
          // If access succeeded, assume embed works.
          setNote('Embedded console seems accessible.', false);
        } catch (e) {
          setNote('Embedding blocked by browser / remote site. Use "Open Console" to open in a new tab.', true);
        }
      }, 300);
    });

    // initial quick check after load
    iframe.addEventListener('load', function(){
      try {
        var doc = iframe.contentDocument || iframe.contentWindow.document;
        setNote('Embedded console loaded.', false);
      } catch (e) {
        setNote('Embedding likely blocked — click "Open Console".', true);
      }
    });
  })();
</script>
